{% extends "base.html" %}

{% block body %}
<header class="dashboard-header">
    <div class="header-content">
        <h1>I-SCANNER</h1>
        <p class="welcome-text">Edit Patient</p>
    </div>
    <div class="header-actions">
        <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">← Back to Dashboard</a>
        <a href="{{ url_for('logout') }}" class="btn btn-logout">Logout</a>
    </div>
</header>

<div class="form-body">
    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <div class="form-container">
        <div class="form-header">
            <h2>Edit Patient Information</h2>
            <p>Update the patient's details below</p>
        </div>

        <!-- Hidden flash messages data for JavaScript -->
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        <div id="flashMessages" style="display: none;">
            {% for category, message in messages %}
            <div data-category="{{ category }}" data-message="{{ message }}"></div>
            {% endfor %}
        </div>
        {% endif %}
        {% endwith %}

        <form method="POST" action="{{ url_for('edit_patient', patient_id=patient.id) }}" class="patient-form">
            <div class="form-group">
                <label for="first_name">First Name <span class="required">*</span></label>
                <input type="text" id="first_name" name="first_name" class="input-field" placeholder="Enter first name"
                    value="{{ patient.first_name }}" required autofocus>
            </div>

            <div class="form-group">
                <label for="last_name">Last Name <span class="required">*</span></label>
                <input type="text" id="last_name" name="last_name" class="input-field" placeholder="Enter last name"
                    value="{{ patient.last_name }}" required>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn btn-primary btn-large">Update Patient</button>
                <a href="{{ url_for('dashboard') }}" class="btn btn-secondary btn-large">Cancel</a>
            </div>
        </form>
    </div>
</div>

<script>
    // ========================================
    // TOAST NOTIFICATION SYSTEM
    // ========================================

    function showToast(message, type = 'success') {
        const toastContainer = document.getElementById('toastContainer');

        const toast = document.createElement('div');
        toast.className = `toast toast-${type}`;

        const icon = type === 'success' ? '✓' : '✕';

        toast.innerHTML = `
        <div class="toast-icon">${icon}</div>
        <div class="toast-content">
            <p class="toast-message">${message}</p>
        </div>
        <button class="toast-close" onclick="closeToast(this)">×</button>
    `;

        toastContainer.appendChild(toast);

        // Auto remove after 5 seconds
        setTimeout(() => {
            closeToast(toast.querySelector('.toast-close'));
        }, 5000);
    }

    function closeToast(button) {
        const toast = button.closest('.toast');
        toast.classList.add('hiding');
        setTimeout(() => {
            toast.remove();
        }, 300);
    }

    // Show flash messages as toasts on page load
    document.addEventListener('DOMContentLoaded', function () {
        const flashMessages = document.getElementById('flashMessages');
        if (flashMessages) {
            const messages = flashMessages.querySelectorAll('[data-category]');
            messages.forEach((msg, index) => {
                setTimeout(() => {
                    const category = msg.dataset.category;
                    const message = msg.dataset.message;
                    showToast(message, category);
                }, index * 100); // Stagger multiple toasts
            });
        }
    });
</script>
{% endblock %}